# ARCH-AEP Master Backlog -- 2026-02-13

**Cycle ID:** AEP-2026-02-13
**Scope:** Full codebase analysis (all 8 Python source files + 4 test files)
**PR Range:** N/A (pre-implementation analysis)
**Generated by:** 5 specialist agents (Architecture, Security, Testing, Performance, Reliability)
**Raw findings:** 96 | **De-duplicated:** 55

---

## Severity Summary

| Severity | Count | Effort Breakdown |
|----------|-------|------------------|
| Critical | 3 | 1S, 2M |
| High | 14 | 10S, 3M, 1L |
| Medium | 22 | 15S, 7M |
| Low | 16 | 14S, 2M |
| **Total** | **55** | **40S, 12M, 1L** |

---

## CRITICAL

### F-001: Unsafe `torch.load()` without `weights_only=True`
- **Severity:** Critical
- **Impact:** Arbitrary code execution via crafted `.pt` file
- **Effort:** S
- **Owning agent:** Security
- **Files:** `chelation_adapter.py:55`, `checkpoint_manager.py:353`
- **Description:** `torch.load(path)` uses pickle deserialization. A malicious adapter weights file executes arbitrary code on load. Both `ChelationAdapter.load()` and the `checkpoint_manager.py` demo block are affected.
- **Acceptance criteria:** All `torch.load()` calls use `weights_only=True`. Tests verify loading still works.
- **Recommended fix:** `torch.load(path, weights_only=True)` in both locations.
- **Dependencies:** None
- **Source findings:** SEC-001, SEC-002, REL-006

### F-002: `benchmark_rlm.py` has zero test coverage (555 lines)
- **Severity:** Critical
- **Impact:** NDCG metric calculations, MTEB data loading, and ID mapping are entirely untested. Incorrect benchmarks would go undetected.
- **Effort:** M
- **Owning agent:** Testing
- **Files:** `benchmark_rlm.py` (entire file)
- **Description:** 8+ functions including `dcg_at_k`, `ndcg_at_k`, `find_keys`, `find_payload`, `load_mteb_data`, `map_predicted_ids` -- none tested. The pure metric functions are trivially testable.
- **Acceptance criteria:** Unit tests for `dcg_at_k`/`ndcg_at_k` with known values, `find_keys`/`find_payload` with nested dicts, `map_predicted_ids` with mock Qdrant. Minimum 8 new tests.
- **Recommended fix:** Create `test_benchmark_rlm.py` with pure function tests.
- **Dependencies:** None
- **Source findings:** TEST-001

### F-003: `checkpoint_manager.py` has zero test coverage (363 lines)
- **Severity:** Critical
- **Impact:** Checkpoint create/restore, SHA256 verification, SafeTrainingContext rollback -- all untested safety-critical paths.
- **Effort:** M
- **Owning agent:** Testing
- **Files:** `checkpoint_manager.py` (entire file)
- **Description:** `CheckpointManager` (6 public methods) and `SafeTrainingContext` (context manager) completely untested. This module handles data safety for training operations.
- **Acceptance criteria:** Tests for create/restore/delete checkpoint, hash verification failure, cleanup, SafeTrainingContext success and failure paths. Minimum 8 new tests.
- **Recommended fix:** Create `test_checkpoint_manager.py` using temp directories.
- **Dependencies:** None
- **Source findings:** TEST-002

---

## HIGH

### F-004: `trust_remote_code=True` in SentenceTransformer loading
- **Severity:** High
- **Impact:** Arbitrary code execution from compromised HuggingFace model repos during model loading
- **Effort:** S
- **Owning agent:** Security
- **Files:** `antigravity_engine.py:62`
- **Description:** `SentenceTransformer(model_name, device=device, trust_remote_code=True)` allows arbitrary Python execution from model repos.
- **Acceptance criteria:** `trust_remote_code=True` removed or gated behind an explicit opt-in parameter.
- **Recommended fix:** Remove `trust_remote_code=True`. If specific models need it, add an allowlist check.
- **Dependencies:** None
- **Source findings:** SEC-010

### F-005: NameError bug in `embed()` ThreadPoolExecutor error handling
- **Severity:** High
- **Impact:** Any Ollama timeout/failure crashes with `NameError` instead of graceful fallback. Latent bug that manifests under load.
- **Effort:** S
- **Owning agent:** Reliability
- **Files:** `antigravity_engine.py:170-180`
- **Description:** `for future in futures:` loop uses variable `i` in except blocks, but `i` is never defined (no `enumerate`). The zero-vector fallback path is unreachable.
- **Acceptance criteria:** `for i, future in enumerate(futures):` and test confirming fallback works.
- **Recommended fix:** Add `enumerate()` to the futures loop.
- **Dependencies:** None
- **Source findings:** REL-002

### F-006: `ChelationConfig` not used by `AntigravityEngine`
- **Severity:** High
- **Impact:** Config changes have zero effect on the engine. False sense of centralized configuration.
- **Effort:** S
- **Owning agent:** Architecture
- **Files:** `antigravity_engine.py:25,33,127,169,173,198,524` vs `config.py`
- **Description:** Engine hardcodes: `ollama_url`, `timeout=30`, `max_workers=2`, `chelation_threshold=0.0004`, `batch_size=100`, `scout_limit=50`. All have corresponding `ChelationConfig` constants that are never imported.
- **Acceptance criteria:** All hardcoded values replaced with `ChelationConfig.*` references. Default `chelation_p=80` changed to `ChelationConfig.DEFAULT_CHELATION_P` (85).
- **Recommended fix:** `from config import ChelationConfig` and replace inline values.
- **Dependencies:** None
- **Source findings:** ARCH-002, ARCH-003, ARCH-008

### F-007: No Qdrant error handling in inference path
- **Severity:** High
- **Impact:** Any Qdrant connectivity issue during inference causes unhandled crash.
- **Effort:** S
- **Owning agent:** Reliability
- **Files:** `antigravity_engine.py:222-236, 517-584`
- **Description:** `query_points()` and `retrieve()` calls in `_gravity_sensor` and `run_inference` are unprotected. Qdrant being unreachable or collection deleted raises unhandled exceptions.
- **Acceptance criteria:** Qdrant calls wrapped with specific exception handling. Graceful error return or retry for transient failures.
- **Recommended fix:** try/except around Qdrant calls with structured logging.
- **Dependencies:** F-006 (for logger), F-010 (for structured logging)
- **Source findings:** REL-018

### F-008: SSRF risk via user-controllable Ollama URL
- **Severity:** High
- **Impact:** Attacker-controlled URL could probe internal network or exfiltrate data
- **Effort:** S
- **Owning agent:** Security
- **Files:** `recursive_decomposer.py:134-169`
- **Description:** `OllamaDecomposer` accepts `ollama_url` parameter passed directly to `requests.post()`. No host validation.
- **Acceptance criteria:** URL validated against allowlist (localhost/127.0.0.1/configured hosts).
- **Recommended fix:** `urlparse` validation of hostname before making requests.
- **Dependencies:** None
- **Source findings:** SEC-003

### F-009: Path traversal in file I/O operations
- **Severity:** High
- **Impact:** Arbitrary file read/write/delete via unchecked paths in public APIs
- **Effort:** M
- **Owning agent:** Security
- **Files:** `chelation_adapter.py:49-55`, `config.py:226-258`, `checkpoint_manager.py:86-97,154-167`
- **Description:** `ChelationAdapter.save/load`, `ChelationConfig.load_from_file/save_to_file`, and `CheckpointManager` create/restore/delete accept arbitrary paths with no containment validation.
- **Acceptance criteria:** Path containment check at all file I/O entry points. Checkpoint names sanitized.
- **Recommended fix:** `Path(path).resolve().is_relative_to(ChelationConfig.PROJECT_ROOT)` validation. `re.sub(r'[^a-zA-Z0-9_-]', '', name)` for checkpoint names.
- **Dependencies:** None
- **Source findings:** SEC-004, SEC-005

### F-010: Engine uses `print()` everywhere instead of `ChelationLogger`
- **Severity:** High
- **Impact:** No structured observability for the core engine. Cannot correlate engine events with decomposer/orchestrator. 34+ print statements.
- **Effort:** M
- **Owning agent:** Architecture
- **Files:** `antigravity_engine.py` (throughout, 34+ call sites)
- **Description:** `antigravity_engine.py` is the only production module using `print()` and a custom `_log_event()` that writes its own JSONL. All other modules use `ChelationLogger`. Two separate log files with different formats are produced.
- **Acceptance criteria:** All `print()` replaced with `get_logger()` calls. `_log_event()` method removed. Single unified log output.
- **Recommended fix:** Import `get_logger()`, replace all print/log_event calls.
- **Dependencies:** F-006 (should be done together)
- **Source findings:** ARCH-004, ARCH-011, REL-005, REL-016

### F-011: Duplicated sedimentation logic across two modules
- **Severity:** High
- **Impact:** Bug fixes must be applied in two places. Divergence risk for training formula, push magnitude (0.1), chunk sizes.
- **Effort:** M
- **Owning agent:** Architecture
- **Files:** `antigravity_engine.py:347-484`, `recursive_decomposer.py:434-676`
- **Description:** `run_sedimentation_cycle()` and `run_hierarchical_sedimentation()` contain near-identical code: target vector calculation, adapter training loop, Qdrant batch update with payload preservation.
- **Acceptance criteria:** Shared sedimentation trainer extracted. Both callers delegate to shared code.
- **Recommended fix:** Extract `SedimentationTrainer` class with target computation, training loop, and Qdrant sync methods.
- **Dependencies:** F-006
- **Source findings:** ARCH-005, ARCH-006, REL-014

### F-012: `chelation_logger.py` has zero direct test coverage (413 lines)
- **Severity:** High
- **Impact:** Broken JSON serialization, file I/O errors, OperationContext stack issues would go undetected
- **Effort:** M
- **Owning agent:** Testing
- **Files:** `chelation_logger.py` (entire file)
- **Description:** 8 public methods, `OperationContext` context manager, and `get_logger` singleton -- all untested. Logger is always mocked in tests.
- **Acceptance criteria:** Tests for `log_event` JSON output, `OperationContext` duration tracking, `get_logger` singleton behavior. Minimum 6 new tests.
- **Recommended fix:** Add to `test_unit_core.py` or create `test_chelation_logger.py`.
- **Dependencies:** None
- **Source findings:** TEST-003

### F-013: `AntigravityEngine` has no unit tests
- **Severity:** High
- **Impact:** `embed()` retry logic, `_chelate_toxicity`, `run_inference` branching, `ingest` batching all untested at unit level
- **Effort:** L
- **Owning agent:** Testing
- **Files:** `antigravity_engine.py` (entire file)
- **Description:** 9 public/private methods with zero mocked unit tests. Only the integration test exercises a subset via live Qdrant.
- **Acceptance criteria:** Mocked unit tests for `embed()` (both modes), `_chelate_toxicity`, `run_inference` (high/low variance paths), `ingest` (empty/normal). Minimum 10 new tests.
- **Recommended fix:** Create `test_antigravity_engine.py` with mocked Qdrant and embedding backends.
- **Dependencies:** None
- **Source findings:** TEST-004, TEST-021

### F-014: `OllamaDecomposer` not tested (response parsing, error handling)
- **Severity:** High
- **Impact:** Regex parsing, HTTP error handling, and fallback behavior all untested
- **Effort:** S
- **Owning agent:** Testing
- **Files:** `recursive_decomposer.py:127-208`
- **Description:** `_parse_response` regex logic, `decompose` HTTP call + fallback, and `is_base_case` threshold are all untested. Only `MockDecomposer` is exercised.
- **Acceptance criteria:** Tests for `_parse_response` (numbered list, bullet list, empty), `decompose` with mocked requests (200, error, timeout). Minimum 6 new tests.
- **Recommended fix:** Add to `test_recursive_decomposer.py` with mocked `requests`.
- **Dependencies:** None
- **Source findings:** TEST-005

### F-015: Unbounded `chelation_log` memory growth
- **Severity:** High
- **Impact:** O(Q * 50 * D) memory per inference cycle. 1000 queries at 768-dim = ~150MB accumulated.
- **Effort:** S
- **Owning agent:** Performance
- **Files:** `antigravity_engine.py:24, 328`
- **Description:** `defaultdict(list)` stores full D-dimensional center_of_mass vectors for every doc in every scout neighborhood. Never pruned.
- **Acceptance criteria:** Memory bounded by cap per doc_id or using running mean/count.
- **Recommended fix:** Cap list length per doc_id (e.g., keep last N), or store running mean + count.
- **Dependencies:** None
- **Source findings:** PERF-001

### F-016: Broad `except Exception` swallows init/connection errors
- **Severity:** High
- **Impact:** Engine silently continues with wrong vector_size (768 default), causing downstream dimension mismatches
- **Effort:** S
- **Owning agent:** Reliability
- **Files:** `antigravity_engine.py:47-50`
- **Description:** Ollama connection test failure caught by bare `except Exception`, printed as WARNING. Engine proceeds with potentially wrong vector size.
- **Acceptance criteria:** Specific exceptions caught. Engine marked degraded or re-raises on config errors.
- **Recommended fix:** Catch `requests.ConnectionError` specifically. Re-raise or set degraded flag for non-transient errors.
- **Dependencies:** F-010 (structured logging)
- **Source findings:** REL-001, SEC-007

### F-017: Fragile conditional `requests` import in `__init__`
- **Severity:** High
- **Impact:** Fragile error handling that references module-level `requests` after conditional import. Could break under refactoring.
- **Effort:** S
- **Owning agent:** Reliability
- **Files:** `antigravity_engine.py:37-46`
- **Description:** `import requests` done inside try block, then `requests.exceptions.ConnectionError` referenced in outer except. Works but is fragile and non-standard.
- **Acceptance criteria:** `requests` imported at module level with try/except ImportError.
- **Recommended fix:** Move `import requests` to top of file with graceful ImportError.
- **Dependencies:** None
- **Source findings:** REL-024

---

## MEDIUM

### F-018: Checkpoint integrity check is warning-only
- **Severity:** Medium
- **Effort:** S
- **Files:** `checkpoint_manager.py:161-163`
- **Description:** SHA256 hash mismatch in `restore_checkpoint()` only warns, still restores the potentially tampered file.
- **Fix:** Make hash mismatch a hard failure: return False.
- **Source:** SEC-014

### F-019: `OllamaDecomposer.decompose()` catches bare `except Exception`
- **Severity:** Medium
- **Effort:** S
- **Files:** `recursive_decomposer.py:189`
- **Description:** All errors silently degrade to "no decomposition". Hides connection failures, parsing bugs, resource exhaustion.
- **Fix:** Catch `(requests.RequestException, json.JSONDecodeError, KeyError)` specifically. Log the exception.
- **Source:** REL-013, SEC-007

### F-020: Qdrant URL/location accepts arbitrary values without validation
- **Severity:** Medium
- **Effort:** S
- **Files:** `antigravity_engine.py:75-79`
- **Description:** `qdrant_location` is checked with `startswith("http")` and passed directly to `QdrantClient`. No URL validation. `None` input crashes with AttributeError.
- **Fix:** Validate URL hostname. Handle None input gracefully.
- **Source:** SEC-008, REL-020

### F-021: Prompt injection in OllamaDecomposer
- **Severity:** Medium
- **Effort:** M
- **Files:** `recursive_decomposer.py:160-166`
- **Description:** User query interpolated directly into LLM prompt. Crafted queries can manipulate decomposition.
- **Fix:** Validate that parsed sub-queries relate to original query. Limit sub-query count.
- **Source:** SEC-006

### F-022: Callback functions (`remediate_fn`, `verify_fn`) without sandboxing
- **Severity:** Medium
- **Effort:** M
- **Files:** `aep_orchestrator.py:617-631, 677-681`
- **Description:** No timeout, validation, or exception wrapping around pluggable callbacks.
- **Fix:** Wrap in try/except with timeout. Validate return types.
- **Source:** SEC-012

### F-023: Division by zero in target vector normalization
- **Severity:** Medium
- **Effort:** S
- **Files:** `antigravity_engine.py:400`, `recursive_decomposer.py:509`
- **Description:** `target_vec / np.linalg.norm(target_vec)` produces NaN if target_vec is zero vector.
- **Fix:** Add `norm = np.linalg.norm(target_vec); if norm > 0: target_vec /= norm`.
- **Source:** REL-015

### F-024: `ChelationAdapter.forward()` crashes on 1D input
- **Severity:** Medium
- **Effort:** S
- **Files:** `chelation_adapter.py:38-47`
- **Description:** Expects 2D `[batch, dim]` tensor. 1D vector causes crash on `normalize(dim=1)`.
- **Fix:** Add `if x.dim() == 1: x = x.unsqueeze(0)` at top of `forward()`.
- **Source:** REL-007

### F-025: `ingest()` does not validate embedding dimensions or handle empty results
- **Severity:** Medium
- **Effort:** S
- **Files:** `antigravity_engine.py:194-220`
- **Description:** No dimension check after `embed()`. Empty embeddings passed to `upsert()` silently. Failed batches unreported.
- **Fix:** Check dimensions match collection. Log and skip failed batches.
- **Source:** REL-004, REL-019

### F-026: `SafeTrainingContext` rollback can mask original exception
- **Severity:** Medium
- **Effort:** S
- **Files:** `checkpoint_manager.py:294-306`
- **Description:** If `restore_checkpoint` raises during exception handling, the original training error is lost.
- **Fix:** Wrap rollback in try/except, log both errors.
- **Source:** REL-010

### F-027: Redundant Qdrant round-trip in `get_chelated_vector()`
- **Severity:** Medium
- **Effort:** S
- **Files:** `antigravity_engine.py:268-287`
- **Description:** Calls `query_points()` without vectors then `retrieve()` for same IDs. Could use `with_vectors=True`.
- **Fix:** Add `with_vectors=True` to initial query, remove second retrieve.
- **Source:** PERF-002

### F-028: Per-element cosine similarity loop in `_spectral_chelation_ranking()`
- **Severity:** Medium
- **Effort:** S
- **Files:** `antigravity_engine.py:336-339`
- **Description:** Python loop over 50 candidates instead of vectorized numpy.
- **Fix:** `scores = centered_candidates @ centered_query / (norms + eps)`.
- **Source:** PERF-003

### F-029: Sequential sub-query retrieval in recursive engine
- **Severity:** Medium
- **Effort:** M
- **Files:** `recursive_decomposer.py:301-308`
- **Description:** Independent sub-queries retrieved sequentially. Latency = N * per_query.
- **Fix:** Use `ThreadPoolExecutor` for sibling sub-query retrieval.
- **Source:** PERF-005

### F-030: `_log_event()` opens/closes file on every call + function-scope imports
- **Severity:** Medium
- **Effort:** S
- **Files:** `antigravity_engine.py:486-515`
- **Description:** File open/write/close + `import json, time` inside function body on every inference call.
- **Fix:** Will be resolved by F-010 (replace with ChelationLogger).
- **Dependencies:** F-010
- **Source:** PERF-004

### F-031: Duplicate Qdrant fetch in sedimentation cycles
- **Severity:** Medium
- **Effort:** S
- **Files:** `antigravity_engine.py:382-403,446-453`, `recursive_decomposer.py:480-489,597-607`
- **Description:** Vectors fetched twice: once for training data, once for payloads during upsert.
- **Fix:** Cache payloads from first retrieve call. Will be resolved by F-011 (shared trainer).
- **Dependencies:** F-011
- **Source:** PERF-006, PERF-007

### F-032: `ChelationLogger` double-writes to log file
- **Severity:** Medium
- **Effort:** S
- **Files:** `chelation_logger.py:62-96`
- **Description:** Every event written via both Python `FileHandler` and direct `open()` JSON write. Mixed formats in log file.
- **Fix:** Remove FileHandler or remove direct writes. Standardize on one output method.
- **Source:** PERF-009, REL-012

### F-033: `parallel_revalidation()` is actually sequential
- **Severity:** Medium
- **Effort:** M
- **Files:** `aep_orchestrator.py:532-553`
- **Description:** Method name says "parallel" but agents run sequentially in a for loop.
- **Fix:** Use `ThreadPoolExecutor` or rename to `revalidation()`.
- **Source:** PERF-011

### F-034: Logger singleton ignores subsequent configuration
- **Severity:** Medium
- **Effort:** S
- **Files:** `chelation_logger.py:345-362`
- **Description:** `get_logger()` silently ignores `log_path`/`console_level` after first call. Misleading API.
- **Fix:** Warn when params differ from existing singleton, or make `get_logger()` param-free.
- **Source:** ARCH-010, REL-011

### F-035: Mixed types in Ollama embedding result array
- **Severity:** Medium
- **Effort:** S
- **Files:** `antigravity_engine.py:161-165, 182`
- **Description:** `_get_embedding` returns Python lists or numpy arrays. `np.array(embeddings)` may produce object array.
- **Fix:** Ensure all elements are numpy arrays of same shape before `np.array()`.
- **Source:** REL-003

### F-036: `HierarchicalSedimentationEngine` edge cases untested
- **Severity:** Medium
- **Effort:** S
- **Files:** `recursive_decomposer.py:434-677`
- **Description:** `_simple_partition` with single vector, identical vectors, `n_clusters=0`. Empty chelation_log.
- **Fix:** Add unit tests for edge cases.
- **Source:** TEST-006

### F-037: AEP orchestrator callback paths untested
- **Severity:** Medium
- **Effort:** S
- **Files:** `aep_orchestrator.py:617-631, 655-689, 740-759`
- **Description:** `remediate_fn` non-dict return, `verify_fn` callback, `run_full_cycle` with callbacks -- all untested.
- **Fix:** Add tests exercising callback integration paths.
- **Source:** TEST-014, TEST-015, TEST-016

### F-038: Tier gate does not enforce no-skip invariant
- **Severity:** Medium
- **Effort:** M
- **Files:** `aep_orchestrator.py:636-637`
- **Description:** The `for severity in Severity:` loop advances to next tier even when current tier has BLOCKED findings.
- **Fix:** Add `break` after tier gate check fails.
- **Source:** REL-028

### F-039: No resource cleanup for Qdrant client
- **Severity:** Medium
- **Effort:** S
- **Files:** `antigravity_engine.py`
- **Description:** Engine creates QdrantClient but no `close()` or context manager. File locks and connections leak.
- **Fix:** Add `close()` method and optionally `__enter__`/`__exit__`.
- **Source:** REL-026

---

## LOW

### F-040: Full document text stored in Qdrant payload
- **Effort:** S | **File:** `antigravity_engine.py:213`
- Increases memory/transfer. Fix: store metadata only; use `with_payload=False` on vector-only queries.
- **Status:** RESOLVED (Session 9, 2026-02-17) - Added payload optimization flags and query payload fetch controls.
- **Source:** PERF-015

### F-041: Benchmark code duplication across two files
- **Effort:** S | **Files:** `benchmark_rlm.py`, `benchmark_evolution.py`
- `dcg_at_k`, `ndcg_at_k`, `load_mteb_data` duplicated. Fix: extract to `benchmark_utils.py`.
- **Status:** RESOLVED (Session 9, 2026-02-17) - Extracted shared benchmark helpers to `benchmark_utils.py`.
- **Source:** ARCH-012

### F-042: `HierarchicalSedimentationEngine` in wrong module
- **Effort:** S | **File:** `recursive_decomposer.py`
- Sedimentation engine unrelated to decomposition. Fix: move to `sedimentation.py`.
- **Status:** RESOLVED (Session 9, 2026-02-17) - Moved class to `sedimentation.py` and re-exported in `recursive_decomposer.py`.
- **Source:** ARCH-007

### F-043: `CheckpointManager` not integrated with any module
- **Effort:** S | **File:** `checkpoint_manager.py`
- Fully implemented but unused. Fix: wire `SafeTrainingContext` into sedimentation.
- **Dependencies:** F-011
- **Source:** ARCH-009

### F-044: No dependency inversion for vector store
- **Effort:** M | **File:** `antigravity_engine.py:74-103`
- Qdrant directly used everywhere. Fix: define VectorStore protocol/ABC.
- **Status:** RESOLVED (Session 9, 2026-02-17) - Added `VectorStore` boundary and `QdrantVectorStore` adapter.
- **Source:** ARCH-013

### F-045: Embedding mode branching via string prefix
- **Effort:** M | **File:** `antigravity_engine.py:29-64, 105-192`
- if/elif branching for Ollama vs local mode. Fix: extract EmbeddingBackend ABC.
- **Status:** RESOLVED (Session 9, 2026-02-17) - Added `embedding_backend.py` abstraction and delegated engine embedding flow.
- **Source:** ARCH-014

### F-046: `AntigravityEngine` god object (584 lines)
- **Effort:** L | **File:** `antigravity_engine.py`
- Mixes embedding, Qdrant management, chelation, training, logging. Fix: decompose (long-term).
- **Dependencies:** F-044, F-045
- **Status:** RESOLVED (Session 10, 2026-02-17) - Scoped chelation-component decomposition extracted to `antigravity_components.py` with behavior-preserving delegation.
- **Source:** ARCH-001

### F-047: `hasattr` check for undeclared `invert_chelation` attribute
- **Effort:** S | **File:** `antigravity_engine.py:246`
- Fix: add `self.invert_chelation = False` to `__init__`.
- **Status:** RESOLVED (Session 10, 2026-02-17) - Added explicit initialization and synchronized delegated chelation behavior.
- **Source:** REL-025

### F-048: `AEPTracker.update_status` raises raw `KeyError` for missing ID
- **Effort:** S | **File:** `aep_orchestrator.py:315`
- Fix: check existence first, raise `ValueError` with helpful message.
- **Status:** RESOLVED (Session 10, 2026-02-17) - Added explicit missing-ID validation with actionable `ValueError`.
- **Source:** REL-027, TEST-018

### F-049: `benchmark_rlm.py` find_payload treats falsy values as not-found
- **Effort:** S | **File:** `benchmark_rlm.py:59-68`
- `if res:` should be `if res is not None:`.
- **Status:** RESOLVED (Session 10, 2026-02-17) - Fixed nested falsy payload handling and updated bug-documenting tests to expected behavior.
- **Source:** REL-021

### F-050: `benchmark_rlm.py` UUID5 ID type mismatch risk
- **Effort:** S | **File:** `benchmark_rlm.py:318-321`
- Fix: standardize ID handling to integers or consistent UUID format.
- **Status:** RESOLVED (Session 10, 2026-02-17) - Canonicalized benchmark ID mapping across `benchmark_rlm.py` and `benchmark_evolution.py`.
- **Source:** REL-022

### F-051: `benchmark_rlm.py` bare except in `map_predicted_ids`
- **Effort:** S | **File:** `benchmark_rlm.py:208-209`
- Fix: catch specific Qdrant exceptions. Let programming bugs propagate.
- **Status:** RESOLVED (Session 11, 2026-02-18) - Narrowed `map_predicted_ids` exception handling to specific Qdrant retrieval exceptions and added propagation coverage for programming errors.
- **Source:** REL-023

### F-052: Integration tests skip silently in CI
- **Effort:** S | **File:** `test_integration_rlm.py:39-42`
- Fix: add CI marker or log warning when skipped.
- **Status:** RESOLVED (Session 11, 2026-02-18) - Added explicit warning when `sentence-transformers` is unavailable while preserving `skipUnless` behavior.
- **Source:** TEST-023

### F-053: Config validation gaps (max_depth, RLM/sedimentation presets, get_config)
- **Effort:** S | **Files:** `config.py` various
- `validate_max_depth`, RLM presets, sedimentation presets, `get_config()` -- all untested.
- **Status:** RESOLVED (Session 11, 2026-02-18) - Added max-depth validation, RLM/sedimentation preset families, preset-type validation, and focused config tests including `get_config()`.
- **Source:** TEST-008, TEST-009, TEST-010, TEST-011, TEST-012

### F-054: AEP tracker minor test gaps
- **Effort:** S | **Files:** `aep_orchestrator.py` various
- `get_unresolved()`, `EffortSize.weight`, `Finding.to_dict()`, discovery fallback defaults -- untested.
- **Status:** RESOLVED (Session 11, 2026-02-18) - Added direct test coverage for unresolved filtering, effort weights, dict serialization, and discovery fallback defaults.
- **Source:** TEST-017, TEST-019, TEST-020, TEST-024

### F-055: Log injection via query text in console output
- **Effort:** S | **Files:** `antigravity_engine.py:499-504`, `chelation_logger.py:88-89`
- Query text newlines/control chars in log output. Fix: strip `\n\r` from query snippets.
- **Status:** RESOLVED (Session 11, 2026-02-18) - Sanitized query snippets in logger query output and added targeted sanitization tests.
- **Source:** SEC-013

---

## Recommended Implementation Order (Tiers)

### Tier 1: Critical (3 findings, ~1 session)
| ID | Title | Effort |
|---|---|---|
| F-001 | `torch.load` weights_only | S |
| F-002 | benchmark_rlm.py tests | M |
| F-003 | checkpoint_manager.py tests | M |

### Tier 2: High Priority Quick Wins (10 findings, S effort, ~1 session)
| ID | Title | Effort |
|---|---|---|
| F-004 | Remove trust_remote_code | S |
| F-005 | Fix NameError in embed() | S |
| F-006 | Wire ChelationConfig into engine | S |
| F-008 | SSRF URL validation | S |
| F-015 | Cap chelation_log growth | S |
| F-016 | Tighten init exception handling | S |
| F-017 | Fix requests import pattern | S |
| F-014 | OllamaDecomposer tests | S |
| F-018 | Checkpoint hash enforcement | S |
| F-019 | Tighten OllamaDecomposer exceptions | S |

### Tier 3: High Priority Medium Effort (4 findings, ~1-2 sessions)
| ID | Title | Effort |
|---|---|---|
| F-009 | Path traversal validation | M |
| F-010 | Replace print() with ChelationLogger | M |
| F-011 | Extract shared sedimentation trainer | M |
| F-012 | ChelationLogger tests | M |
| F-013 | AntigravityEngine unit tests | L |

### Tier 4: Medium Priority (22 findings, ongoing)
All Medium severity findings, prioritized by effort (S first).

### Tier 5: Low Priority (16 findings, backlog)
All Low severity findings, addressed opportunistically.

---

## Cross-Cutting Themes

1. **`antigravity_engine.py` is the weakest module**: 70%+ of High/Critical findings trace to this file. It needs config integration, logging overhaul, error handling, and unit tests.
2. **Error handling is inconsistent**: The engine uses broad `except Exception` + `print()`. Newer modules use structured logging but still have bare excepts in key paths.
3. **Sedimentation is duplicated**: Two independent copies of the same training + Qdrant update logic.
4. **Test coverage is concentrated**: Unit tests cover adapter, config, decomposer, and AEP well, but logger, checkpoint, benchmark, and engine are entirely untested.
5. **Security posture is reasonable for a research prototype**: No eval/exec/subprocess, no hardcoded secrets. Main risks are `torch.load`, `trust_remote_code`, and path traversal in public APIs.
